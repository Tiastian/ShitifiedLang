<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShitLang Logo Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a; /* Dark background for contrast */
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .loader {
            border: 8px solid #f3f3f3; /* Light grey */
            border-top: 8px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            background-color: #4a0e0e; /* Dark red */
            color: #ffc0c0; /* Light red */
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #8B0000; /* Darker red border */
            margin-top: 20px;
            text-align: center;
        }
        .image-container {
            background-color: #2c2c2c; /* Slightly lighter dark shade */
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            margin-top: 30px;
            max-width: 500px;
            width: 100%;
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
        }
        .title-header {
            font-size: 2.5rem;
            font-weight: bold;
            color: #7f5af0; /* Purple accent */
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(127, 90, 240, 0.5);
        }
        .description {
            text-align: center;
            margin-bottom: 2rem;
            color: #a0a0a0; /* Lighter gray for description */
        }
        .retry-button {
            background-color: #7f5af0; /* Purple */
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
            display: block;
            margin: 20px auto 0;
        }
        .retry-button:hover {
            background-color: #6941c6; /* Darker purple */
        }
    </style>
</head>
<body>
    <div class="container mx-auto p-4 text-center">
        <h1 class="title-header">ShitLang Logo Generator</h1>
        <p class="description">Generating a logo for the fictional programming language "ShitLang".</p>

        <div id="logoContainer" class="image-container hidden">
            <img id="logoImage" src="" alt="ShitLang Logo">
        </div>

        <div id="loadingIndicator" class="text-center">
            <div class="loader"></div>
            <p>Generating your logo... this might take a moment.</p>
            <p class="text-sm text-gray-400">The prompt includes a cartoon poop emoji, a magnifying glass showing broken code, a fading CPU, and the slogan 'Optimized with Entropy'.</p>
        </div>

        <div id="errorMessage" class="error-message hidden">
            <p>Sorry, there was an error generating the logo. Please try again.</p>
            <button id="retryButton" class="retry-button">Try Again</button>
        </div>
    </div>

    <script>
        // --- Firebase and App ID setup (placeholders if not in a specific environment) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id-shitlang-logo';
        // IMPORTANT: In a real Firebase setup, __firebase_config would be provided.
        // For this standalone example, we'll use a placeholder.
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "YOUR_API_KEY", // Replace with actual config if needed
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // --- DOM Elements ---
        const logoContainer = document.getElementById('logoContainer');
        const logoImage = document.getElementById('logoImage');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const retryButton = document.getElementById('retryButton');

        // --- Image Generation Function ---
        async function generateLogo() {
            console.log("Attempting to generate logo...");
            loadingIndicator.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            logoContainer.classList.add('hidden');

            const prompt = "Create a logo for a fictional programming language called 'ShitLang'. The logo should be humorous yet convey a sense of system breakdown. Central element: a friendly, cartoonish poop emoji. A magnifying glass is inspecting the poop emoji. Inside the magnifying glass view, display fragments of broken code, glitchy text, or abstract error symbols (e.g., 'NaN', '0xDEADBEEF', garbled characters). Subtle background elements: a faint, stylized CPU chip that appears to be glitching, cracking, or fading into disorder. At the bottom of the logo, include the slogan 'Optimized with Entropy' in a clear, slightly distressed or pixelated font. The overall aesthetic should be a polished cartoon style with a tech-dystopian twist. Ensure the slogan is legible.";

            const payload = {
                instances: { prompt: prompt },
                parameters: { "sampleCount": 1 }
            };
            const apiKey = ""; // Left empty for Canvas to inject
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

            try {
                console.log("Sending request to API:", apiUrl, "with payload:", JSON.stringify(payload).substring(0,100) + "..."); // Log snippet of payload
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                console.log("Response status:", response.status);
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("API Error Response Text:", errorText);
                    throw new Error(`API request failed with status ${response.status}: ${errorText}`);
                }

                const result = await response.json();
                console.log("API Result:", JSON.stringify(result).substring(0,200) + "..."); // Log snippet of result

                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    logoImage.src = imageUrl;
                    logoContainer.classList.remove('hidden');
                    console.log("Logo generated successfully.");
                } else {
                    console.error("Unexpected API response structure or no image data:", result);
                    throw new Error('Image data not found in API response.');
                }
            } catch (error) {
                console.error('Error generating logo:', error);
                errorMessage.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
                console.log("Image generation process finished.");
            }
        }

        // --- Event Listeners ---
        retryButton.addEventListener('click', generateLogo);

        // --- Initial Load ---
        // Automatically generate the logo when the page loads.
        window.onload = () => {
            console.log("Window loaded, starting logo generation.");
            generateLogo();
        };
    </script>
</body>
</html>
